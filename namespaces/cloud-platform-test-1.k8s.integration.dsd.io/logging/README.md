# Logging with Fluentd to ElasticSearch on Kubernetes 

## Introduction
The files within this directory, when deployed together will install Fluentd and will collect all of the logs being generated by every container in the cluster.

Fluentd, in real-time, will transport the collected logs to your specified ElasticSearch endpoint.

These files are a customised version of the official Kubernetes `fluentd-es` templates. [Repo link.](https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/fluentd-elasticsearch)

This README uses the `test-1` cluster in it's examples, but this information should be applicable to any cluster you are seeking to deploy this on.

## Pre-Reqs
This guide assumes you have already configured or have access to an AWS Hosted ElasticSearch.

## File-Breakdown

### Logging Namespace

The `00.namespace.yaml` file simply creates a 'logging' namespace in the cluster. 

This is where fluent-es will be deployed, and therfore has to be the first of the 3 files to be deployed.

It is strongly advised that these 3 files are deployed by deploying all the contents of this directory together. 

Example: `$ kubectl create -f logging/`

### Application & RBAC

The `kube-fluentd-es.yaml` file is the core file that specifys the container and deploys the application. The `fluentd-es` containers are deployed through a `DaemonSet`. This means whenever a new container is created anywhere in the cluster, a `fluentd-es` pod will also be deployed and logging of the container will start automatically. 

In addition to the application's `DaemonSet`, there are an additional 3 parts to the file that handle the RBAC permissions. The parts that handle the RBAC are a `ServiceAccount`, a `ClusterRole`, and a `ClusterRoleBinding`. 

### Application ConfigMap

The `kube-fluentd-es-config.yaml` file is the config file that `fluentd-es` depends on for all of it's default configurations. Don't be overwhelmbed by the size of this file as over 99% of it's contents are default and shouldn't be touched. The only part of this file that you should concern yourself with is the very last block of code at the bottom, within the `<match>` tag.


## Configuration 

### Overview

### File Changes

## Notes of considerations

..